{"version":3,"sources":["webpack:///./src/budget/budget.controller.ts","webpack:///./src/budget/budget.module.ts","webpack:///./src/budget/budget.service.ts"],"names":[],"mappings":";;;;;;;;;;;AAAa;AACb;AACA;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,oCAAoC;AACvE;AACA;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA,8CAA8C,cAAc;AAC5D,iBAAiB,mBAAO,CAAC,sCAAgB;AACzC,yBAAyB,mBAAO,CAAC,wDAAkB;AACnD,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,mBAAmB,mBAAO,CAAC,0CAAkB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9Ea;AACb;AACA;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA,8CAA8C,cAAc;AAC5D,iBAAiB,mBAAO,CAAC,sCAAgB;AACzC,kBAAkB,mBAAO,CAAC,wCAAiB;AAC3C,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,4BAA4B,mBAAO,CAAC,8DAAqB;AACzD,yBAAyB,mBAAO,CAAC,wDAAkB;AACnD;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;;;;;;;;;;;;AC1Ba;AACb;AACA;AACA;AACA,4CAA4C,QAAQ;AACpD;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,oCAAoC;AACvE;AACA;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA,8CAA8C,cAAc;AAC5D,iBAAiB,mBAAO,CAAC,sCAAgB;AACzC,kBAAkB,mBAAO,CAAC,wCAAiB;AAC3C,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,kBAAkB,mBAAO,CAAC,wBAAS;AACnC,wBAAwB,mBAAO,CAAC,kEAAuB;AACvD,0BAA0B,mBAAO,CAAC,gEAA0B;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,+CAA+C,SAAS;AACxD,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2GAA2G,SAAS;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F,iBAAiB,gBAAgB,mBAAmB,gBAAgB,eAAe;AAC7K;AACA;AACA,0FAA0F,iBAAiB,gBAAgB,mBAAmB,gBAAgB,eAAe;AAC7K;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0FAA0F,iBAAiB,gBAAgB,mBAAmB,gBAAgB,eAAe;AAC7K;AACA;AACA,0FAA0F,iBAAiB,gBAAgB,mBAAmB,gBAAgB,eAAe;AAC7K;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.d5ad5e1171cd16f9aa3c.hot-update.js","sourcesContent":["\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst common_1 = require(\"@nestjs/common\");\r\nconst budget_service_1 = require(\"./budget.service\");\r\nconst budget_entity_1 = require(\"./enity/budget.entity\");\r\nconst action_entity_1 = require(\"./enity/action.entity\");\r\nconst passport_1 = require(\"@nestjs/passport\");\r\nlet BudgetController = class BudgetController {\r\n    constructor(budgetService) {\r\n        this.budgetService = budgetService;\r\n    }\r\n    createBudget(res, req, budget) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this.budgetService.createBudget(req.user, budget);\r\n        });\r\n    }\r\n    getBudgets(req, res) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let responseEntity = yield this.budgetService.getBudgets(req.user);\r\n            res.status(responseEntity.getStatus()).json(responseEntity.getResponseObject());\r\n        });\r\n    }\r\n    perfomAction(req, res, budgetId, actionDTO) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let responseEntity = yield this.budgetService.performAction(req.user, actionDTO, budgetId);\r\n            res.status(responseEntity.getStatus()).json(responseEntity.getResponseObject());\r\n        });\r\n    }\r\n};\r\n__decorate([\r\n    common_1.UseGuards(passport_1.AuthGuard('jwt')),\r\n    common_1.Post(\"/new\"),\r\n    __param(0, common_1.Res()), __param(1, common_1.Req()), __param(2, common_1.Body(\"budget\")),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [Object, Object, budget_entity_1.BudgetDTO]),\r\n    __metadata(\"design:returntype\", Promise)\r\n], BudgetController.prototype, \"createBudget\", null);\r\n__decorate([\r\n    common_1.UseGuards(passport_1.AuthGuard(\"jwt\")),\r\n    common_1.Get(),\r\n    __param(0, common_1.Req()), __param(1, common_1.Res()),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [Object, Object]),\r\n    __metadata(\"design:returntype\", Promise)\r\n], BudgetController.prototype, \"getBudgets\", null);\r\n__decorate([\r\n    common_1.UseGuards(passport_1.AuthGuard(\"jwt\")),\r\n    common_1.Post(\"/action/:budgetId\"),\r\n    __param(0, common_1.Req()), __param(1, common_1.Res()), __param(2, common_1.Param(\"budgetId\")), __param(3, common_1.Body(\"action\")),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [Object, Object, Object, action_entity_1.ActionDTO]),\r\n    __metadata(\"design:returntype\", Promise)\r\n], BudgetController.prototype, \"perfomAction\", null);\r\nBudgetController = __decorate([\r\n    common_1.Controller(\"/api/budget\"),\r\n    __metadata(\"design:paramtypes\", [budget_service_1.BudgetService])\r\n], BudgetController);\r\nexports.BudgetController = BudgetController;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst common_1 = require(\"@nestjs/common\");\r\nconst typeorm_1 = require(\"@nestjs/typeorm\");\r\nconst budget_entity_1 = require(\"./enity/budget.entity\");\r\nconst action_entity_1 = require(\"./enity/action.entity\");\r\nconst budget_controller_1 = require(\"./budget.controller\");\r\nconst budget_service_1 = require(\"./budget.service\");\r\nlet BudgetModule = class BudgetModule {\r\n    configure(customer) { }\r\n};\r\nBudgetModule = __decorate([\r\n    common_1.Module({\r\n        imports: [\r\n            typeorm_1.TypeOrmModule.forFeature([budget_entity_1.Budget, action_entity_1.Action])\r\n        ],\r\n        controllers: [budget_controller_1.BudgetController],\r\n        providers: [budget_service_1.BudgetService]\r\n    })\r\n], BudgetModule);\r\nexports.BudgetModule = BudgetModule;\r\n","\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst common_1 = require(\"@nestjs/common\");\r\nconst typeorm_1 = require(\"@nestjs/typeorm\");\r\nconst budget_entity_1 = require(\"./enity/budget.entity\");\r\nconst typeorm_2 = require(\"typeorm\");\r\nconst action_entity_1 = require(\"./enity/action.entity\");\r\nconst response_entity_1 = require(\"../utils/response.entity\");\r\nlet BudgetService = class BudgetService {\r\n    constructor(budgetRepository, actionRepository) {\r\n        this.budgetRepository = budgetRepository;\r\n        this.actionRepository = actionRepository;\r\n    }\r\n    createBudget(userPayload, budgetDTO) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const budget = this.budgetRepository.create(budgetDTO);\r\n            budget.userId = userPayload.userId;\r\n            return yield this.budgetRepository.save(budget);\r\n        });\r\n    }\r\n    getBudgets(userPayload) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let bugets = yield this.getBudgetsByUserId(userPayload.userId);\r\n            return response_entity_1.ResponseEntityFor.successWith(bugets);\r\n        });\r\n    }\r\n    getBudgetsByUserId(userId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this.budgetRepository.find({ userId });\r\n        });\r\n    }\r\n    performAction(userPayload, actionDTO, budgetId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let userBudgets = yield this.getBudgetsByUserId(userPayload.userId);\r\n            if (userBudgets.length === 0) {\r\n                return response_entity_1.ResponseEntityFor.failureWith(`User does not have Budgets`);\r\n            }\r\n            let budgetsById = userBudgets.filter(budget => budget.id === budgetId);\r\n            if (budgetsById.length === 0) {\r\n                return response_entity_1.ResponseEntityFor.failureWith(`User does not have Budget by id '${budgetId}'`);\r\n            }\r\n            let budget = budgetsById[0];\r\n            let action = this.actionRepository.create(actionDTO);\r\n            action.budgetId = budgetId;\r\n            action.timeStamp = new Date();\r\n            if (action.type === action_entity_1.ActionType.WITHDRAW) {\r\n                if (budget.balance >= action.amount && action.amount >= 0) {\r\n                    budget.balance -= action.amount;\r\n                    let savedAction = yield this.saveAction(action);\r\n                    let savedBudget = yield this.saveBudget(budget);\r\n                    if (savedAction && savedBudget) {\r\n                        return response_entity_1.ResponseEntityFor.successWith(`Action '${savedAction.type}' for amount '${savedAction.amount}' for Budget '${savedBudget.id}' was perfomed succesfuly`);\r\n                    }\r\n                    else {\r\n                        return response_entity_1.ResponseEntityFor.failureWith(`Action '${savedAction.type}' for amount '${savedAction.amount}' for Budget '${savedBudget.id}' was not perfomed`);\r\n                    }\r\n                }\r\n                return response_entity_1.ResponseEntityFor.failureWith(\"Invalid request. Can not WITHDRAW more than have or negative amount\");\r\n            }\r\n            else if (action.type == action_entity_1.ActionType.DEPOSIT) {\r\n                if (action.amount > 0) {\r\n                    budget.balance += action.amount;\r\n                    let savedAction = yield this.saveAction(action);\r\n                    let savedBudget = yield this.saveBudget(budget);\r\n                    if (savedAction && savedBudget) {\r\n                        return response_entity_1.ResponseEntityFor.successWith(`Action '${savedAction.type}' for amount '${savedAction.amount}' for Budget '${savedBudget.id}' was perfomed succesfuly`);\r\n                    }\r\n                    else {\r\n                        return response_entity_1.ResponseEntityFor.failureWith(`Action '${savedAction.type}' for amount '${savedAction.amount}' for Budget '${savedBudget.id}' was not perfomed`);\r\n                    }\r\n                }\r\n                return response_entity_1.ResponseEntityFor.failureWith(\"Invalid request. Can not DEPOSITO negative amount\");\r\n            }\r\n            return response_entity_1.ResponseEntityFor.failureWith(\"Invalid request\");\r\n        });\r\n    }\r\n    saveBudget(budget) {\r\n        return this.budgetRepository.save(budget);\r\n    }\r\n    saveAction(action) {\r\n        return this.actionRepository.save(action);\r\n    }\r\n};\r\nBudgetService = __decorate([\r\n    common_1.Injectable(),\r\n    __param(0, typeorm_1.InjectRepository(budget_entity_1.Budget)),\r\n    __param(1, typeorm_1.InjectRepository(action_entity_1.Action)),\r\n    __metadata(\"design:paramtypes\", [typeorm_2.Repository,\r\n        typeorm_2.Repository])\r\n], BudgetService);\r\nexports.BudgetService = BudgetService;\r\n"],"sourceRoot":""}